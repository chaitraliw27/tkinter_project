import requests
from requests.auth import HTTPBasicAuth

# Jira credentials
jira_url = 'https://your-domain.atlassian.net'
username = 'your-email@example.com'
api_token = 'your-api-token'

# Authentication
auth = HTTPBasicAuth(username, api_token)

# Issue key
issue_key = 'PROJECT-123'
issue_url = f'{jira_url}/rest/api/3/issue/{issue_key}'

# Fetch issue details
response = requests.get(issue_url, auth=auth)
issue_data = response.json()

# Check for CSV attachments
attachments = issue_data['fields']['attachment']
csv_attachment = None

for attachment in attachments:
    if attachment['filename'].endswith('.csv'):
        csv_attachment = attachment
        break

if not csv_attachment:
    print("No CSV attachment found.")
else:
    print(f"Found CSV attachment: {csv_attachment['filename']}")

    # Download the CSV attachment
    csv_url = csv_attachment['content']
    csv_response = requests.get(csv_url, auth=auth)

    with open(csv_attachment['filename'], 'wb') as f:
        f.write(csv_response.content)

    print(f"Downloaded CSV file: {csv_attachment['filename']}")
